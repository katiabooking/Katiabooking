# 👤 CLIENT GIFT CARD DASHBOARD

## 📱 Двойная система для клиентов

Каждый клиент имеет **ДВА вида** сертификатов в своём кабинете:

```
┌─────────────────────────────────────────────┐
│  My Gift Cards                              │
├─────────────────────────────────────────────┤
│                                             │
│  [📤 Purchased (3)] | [📥 Received (2)]    │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 📤 ВКЛАДКА "PURCHASED" (Купленные)

### **Что видит покупатель:**

```
┌────────────────────────────────────────────────────────┐
│  📤 Purchased Gift Cards (3)                          │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │  Glamour Studio                  🟡 Partially Used│ │
│  │  KATIA-A7X9-2K4M-3P5Q           [Copy Code]      │ │
│  │                                                   │ │
│  │  📤 Sent to: Jane Smith (jane@email.com)         │ │
│  │  💬 "Happy Birthday! Enjoy your spa day! 🎂"    │ │
│  │                                                   │ │
│  │  Balance: AED 80                                 │ │
│  │  of AED 200                                      │ │
│  │  AED 120 used                                    │ │
│  │                                                   │ │
│  │  [Resend Email] [Download] [▼ View Details]     │ │
│  │                                                   │ │
│  │  ▼ Usage History:                                │ │
│  │  ┌────────────────────────────────────────────┐  │ │
│  │  │ Mar 5  - Haircut & Styling   -AED 60      │  │ │
│  │  │          Balance: AED 140                  │  │ │
│  │  ├────────────────────────────────────────────┤  │ │
│  │  │ Mar 10 - Manicure            -AED 60      │  │ │
│  │  │          Balance: AED 80                   │  │ │
│  │  │          ✅ Used by Jane Smith             │  │ │
│  │  └────────────────────────────────────────────┘  │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │  Beauty Haven                    🟢 Active       │ │
│  │  KATIA-B2C4-7F9P-5M8K           [Copy Code]      │ │
│  │                                                   │ │
│  │  📤 Sent to: Mom (mom@email.com)                 │ │
│  │  💬 "Happy Mother's Day! You deserve the best!"│ │
│  │                                                   │ │
│  │  Balance: AED 300                                │ │
│  │  of AED 300                                      │ │
│  │  ✨ Unused                                       │ │
│  │                                                   │ │
│  │  [Resend Email] [Download] [Use Now]            │ │
│  └──────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────┘
```

### **Информация для покупателя:**

✅ **Может видеть:**
- Кому отправил (имя + email)
- Своё персональное сообщение
- Когда купил
- Остаток баланса
- **КТО И КОГДА использовал** ⭐
- **ЧТО именно использовал** (название услуги) ⭐
- Сколько использовано

✅ **Может делать:**
- Copy code
- Resend email получателю
- Download красивое фото
- View full history
- Track usage в real-time ⭐

---

## 📥 ВКЛАДКА "RECEIVED" (Полученные)

### **Что видит получатель:**

```
┌────────────────────────────────────────────────────────┐
│  📥 Received Gift Cards (2)                           │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │  Luxury Spa                      🟡 Partially Used│ │
│  │  KATIA-C3D5-8G2J-9N4L           [Copy Code]      │ │
│  │                                                   │ │
│  │  📥 From: Sarah Johnson                          │ │
│  │  ╔═══════════════════════════════════════════╗   │ │
│  │  ║ 💜 "For your birthday! Treat yourself! 🎉" ║   │ │
│  │  ╚═══════════════════════════════════════════╝   │ │
│  │                                                   │ │
│  │  Balance: AED 350                                │ │
│  │  of AED 500                                      │ │
│  │  AED 150 used by you                             │ │
│  │                                                   │ │
│  │  [Download] [Use Now] [▼ View Details]          │ │
│  │                                                   │ │
│  │  ▼ Your Usage:                                   │ │
│  │  ┌────────────────────────────────────────────┐  │ │
│  │  │ Mar 8  - Full Body Massage   -AED 150     │  │ │
│  │  │          Balance: AED 350                  │  │ │
│  │  │          ✅ You used this                  │  │ │
│  │  └────────────────────────────────────────────┘  │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │  Glamour Studio                  ✅ Fully Used   │ │
│  │  KATIA-E4F6-1H8K-2P9M           [Copy Code]      │ │
│  │                                                   │ │
│  │  📥 From: Mike Brown                             │ │
│  │  ╔═══════════════════════════════════════════╗   │ │
│  │  ║ 💜 "Valentine's gift for my buddy! ❤️"     ║   │ │
│  │  ╚═══════════════════════════════════════════╝   │ │
│  │                                                   │ │
│  │  Balance: AED 0                                  │ │
│  │  of AED 150                                      │ │
│  │  AED 150 used by you                             │ │
│  │                                                   │ │
│  │  ▼ Your Usage:                                   │ │
│  │  ┌────────────────────────────────────────────┐  │ │
│  │  │ Feb 20 - Haircut             -AED 80      │  │ │
│  │  │          Balance: AED 70                   │  │ │
│  │  ├────────────────────────────────────────────┤  │ │
│  │  │ Feb 25 - Beard Grooming      -AED 70      │  │ │
│  │  │          Balance: AED 0                    │  │ │
│  │  │          ✅ Fully used                     │  │ │
│  │  └────────────────────────────────────────────┘  │ │
│  └──────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────┘
```

### **Информация для получателя:**

✅ **Может видеть:**
- От кого получил
- Персональное сообщение **на красивом фоне** 💜
- Остаток баланса
- Свою историю использования
- Когда и что использовал

✅ **Может делать:**
- Use gift card при бронировании
- Download красивое фото
- Copy code
- View full history

---

## 🔔 REAL-TIME NOTIFICATIONS

### **Когда получатель использует сертификат:**

#### **У ПОКУПАТЕЛЯ появляется:**

```
┌────────────────────────────────────────────┐
│  🔔 Notifications (1)                      │
├────────────────────────────────────────────┤
│                                            │
│  🎉 Jane Smith used your gift card        │
│                                            │
│  Jane Smith used AED 60 for Haircut &     │
│  Styling at Glamour Studio.               │
│                                            │
│  -AED 60 used    AED 140 left             │
│                                            │
│  2 minutes ago   KATIA-A7X9-2K4M-3P5Q     │
│                                            │
│  [View Gift Card →]                        │
└────────────────────────────────────────────┘
```

#### **У ПОЛУЧАТЕЛЯ появляется:**

```
┌────────────────────────────────────────────┐
│  🔔 Notifications (1)                      │
├────────────────────────────────────────────┤
│                                            │
│  🎉 You used your gift card               │
│                                            │
│  You used AED 60 for Haircut & Styling.   │
│  Remaining balance: AED 140               │
│                                            │
│  -AED 60 used    AED 140 left             │
│                                            │
│  2 minutes ago   KATIA-A7X9-2K4M-3P5Q     │
│                                            │
│  [View Gift Card →]                        │
└────────────────────────────────────────────┘
```

### **Типы уведомлений:**

```typescript
// Для покупателя:
✅ "Gift card sent to Jane Smith"
👀 "Jane Smith viewed your gift card"
🎉 "Jane Smith used your gift card" ⭐ ВАЖНО
⏰ "Gift card has expired"

// Для получателя:
📥 "You received a gift card from Sarah!"
🎉 "You used AED 60 from your gift card" ⭐ ВАЖНО
⏰ "Your gift card expires in 7 days"
```

---

## 📊 SUMMARY STATS

### **Вверху каждой вкладки:**

```
┌──────────────────────────────────────────────────────┐
│  📤 Purchased                                        │
├──────────────────────────────────────────────────────┤
│                                                      │
│  ┌───────────────┐ ┌───────────────┐ ┌────────────┐│
│  │ Total Value   │ │ Sent Balance  │ │ Recipients ││
│  │ AED 1,500     │ │ AED 880       │ │ 5 people   ││
│  └───────────────┘ └───────────────┘ └────────────┘│
│                                                      │
│  [Buy New Gift Card]                                │
└──────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────┐
│  📥 Received                                         │
├──────────────────────────────────────────────────────┤
│                                                      │
│  ┌───────────────┐ ┌───────────────┐ ┌────────────┐│
│  │ Total Value   │ │ Available     │ │ Active     ││
│  │ AED 650       │ │ AED 350       │ │ 2 cards    ││
│  └───────────────┘ └───────────────┘ └────────────┘│
│                                                      │
└──────────────────────────────────────────────────────┘
```

---

## 🎯 FLOW ДИАГРАММА

### **Когда сертификат используется:**

```
┌──────────────────────────────────────────────────────┐
│           BOOKING WITH GIFT CARD                     │
└──────────────────────────────────────────────────────┘

1. Получатель бронирует услугу:
   ┌─────────────────────────┐
   │ Book Haircut - AED 60   │
   │                         │
   │ ☑ Have a gift card?     │
   │ Enter: KATIA-A7X9...    │
   │                         │
   │ ✅ Valid! AED 200 left  │
   │ Apply AED 60 → Pay AED 0│
   └─────────────────────────┘

2. Backend обновляет:
   ┌─────────────────────────┐
   │ Gift Card Updated       │
   │                         │
   │ Remaining: AED 200      │
   │          → AED 140      │
   │                         │
   │ Status: Active          │
   │       → Partially Used  │
   │                         │
   │ Usage +1 record         │
   └─────────────────────────┘

3. Real-time уведомления:
   ┌──────────────────────────────────────┐
   │ ПОКУПАТЕЛЬ (John)                    │
   │ 🔔 Jane used AED 60 at Glamour Studio│
   │    Balance: AED 140 left             │
   └──────────────────────────────────────┘
   
   ┌──────────────────────────────────────┐
   │ ПОЛУЧАТЕЛЬ (Jane)                    │
   │ 🔔 You used AED 60 for Haircut       │
   │    Balance: AED 140 left             │
   └──────────────────────────────────────┘

4. Email уведомления (опционально):
   📧 → john@email.com
   "Jane used your gift card at Glamour Studio"
   
   📧 → jane@email.com
   "You used AED 60 from your gift card"

5. Dashboard обновляется АВТОМАТИЧЕСКИ:
   
   У John в "Purchased":
   ✅ Status: Active → Partially Used
   ✅ Balance: AED 200 → AED 140
   ✅ Usage History: +1 запись
   
   У Jane в "Received":
   ✅ Status: Active → Partially Used
   ✅ Balance: AED 200 → AED 140
   ✅ Usage History: +1 запись
```

---

## 🔐 DATA SYNC

### **KV Store структура:**

```typescript
// Purchased gift cards для пользователя
"user:john@email.com:giftcards:purchased" → [
  "KATIA-A7X9-2K4M-3P5Q",
  "KATIA-B2C4-7F9P-5M8K"
]

// Received gift cards для пользователя
"user:jane@email.com:giftcards:received" → [
  "KATIA-A7X9-2K4M-3P5Q"
]

// Сам сертификат (shared)
"giftcard:KATIA-A7X9-2K4M-3P5Q" → {
  purchasedBy: "john@email.com",
  recipientEmail: "jane@email.com",
  remainingBalance: 140,
  usageHistory: [...]
}
```

### **Когда баланс обновляется:**

```typescript
1. POST /gift-cards/redeem
   {
     code: "KATIA-A7X9-2K4M-3P5Q",
     amountToUse: 60,
     bookingId: "booking123"
   }

2. Backend:
   - Загрузить сертификат
   - Проверить валидность
   - Обновить баланс (200 - 60 = 140)
   - Добавить usage record
   - Обновить статус
   - Сохранить в KV

3. Отправить WebSocket/Polling update:
   → Покупателю (john@email.com)
   → Получателю (jane@email.com)

4. Frontend автоматически обновляет UI
```

---

## 💡 КЛЮЧЕВЫЕ ФИЧИ

### **✅ ДЛЯ ПОКУПАТЕЛЯ:**

1. **Tracking** - видит когда и что использовано
2. **Real-time updates** - мгновенные уведомления
3. **Resend email** - может переслать сертификат
4. **Download** - скачать красивое фото
5. **History** - полная история использования
6. **Visibility** - знает, кто именно использовал

### **✅ ДЛЯ ПОЛУЧАТЕЛЯ:**

1. **Easy access** - видит все подарки в одном месте
2. **Personal messages** - красивое отображение сообщений
3. **Use quickly** - кнопка "Use Now"
4. **Track balance** - следит за остатком
5. **History** - своя история использования

### **✅ ДЛЯ ОБОИХ:**

1. **Real-time sync** - оба видят изменения сразу
2. **Beautiful UI** - градиенты, иконки, статусы
3. **Copy code** - быстрое копирование
4. **Status badges** - 🟢 Active, 🟡 Partially Used, ✅ Fully Used
5. **Responsive** - работает на всех устройствах

---

## 🎨 UI/UX ДЕТАЛИ

### **Status Colors:**

```
🟢 Active          - Зелёный (не использован)
🟡 Partially Used  - Жёлтый (использован частично)
✅ Fully Used      - Серый (использован полностью)
⏰ Expired         - Красный (истёк срок)
❌ Cancelled       - Красный (отменён)
```

### **Progress Bar для баланса:**

```
┌────────────────────────────────────────┐
│ AED 80 / AED 200                       │
│ ████████░░░░░░░░░░░░░░░░ 40% remaining │
└────────────────────────────────────────┘
```

### **Usage Timeline:**

```
Mar 10  ●───┐
            │ Manicure - AED 60
            │ Balance: AED 80
            │
Mar 5   ●───┤
            │ Haircut - AED 60
            │ Balance: AED 140
            │
Mar 1   ●───┘
            Purchased - AED 200
```

---

**ГОТОВО! 🎉**

Теперь:
- ✅ Owner редактирует amounts в dashboard
- ✅ Клиент видит Purchased (что купил, кому отправил)
- ✅ Клиент видит Received (что получил, от кого)
- ✅ Real-time updates когда кто-то использует
- ✅ Оба (покупатель и получатель) видят обновления
- ✅ Beautiful UI с градиентами и статусами
