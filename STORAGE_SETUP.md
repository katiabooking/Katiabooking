# üì¶ Supabase Storage - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ –≤–∏–¥–Ω–æ –±–∞–∫–µ—Ç–∞ `katia-images` –≤ Supabase Storage Dashboard.

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü—É Storage:**
   ```
   http://localhost:5173/#/storage-admin
   ```
   –∏–ª–∏ –≤ production:
   ```
   https://yourdomain.com/#/storage-admin
   ```

2. **–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç —Å—Ç–∞—Ç—É—Å –±–∞–∫–µ—Ç–∞:**
   - ‚úÖ –ï—Å–ª–∏ –±–∞–∫–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø–∞–ø–∫–∞–º
   - ‚ö†Ô∏è –ï—Å–ª–∏ –±–∞–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω - –ø–æ–∫–∞–∂–µ—Ç –∫–Ω–æ–ø–∫—É "Initialize Bucket"

3. **–ù–∞–∂–º–∏—Ç–µ "Initialize Bucket":**
   - –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—Å—Ç –±–∞–∫–µ—Ç `katia-images`
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –ª–∏–º–∏—Ç—ã (5MB per file)
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç MIME —Ç–∏–ø—ã –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ API endpoint

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:**
```bash
curl https://YOUR_PROJECT_ID.supabase.co/functions/v1/make-server-3e5c72fb/storage/status \
  -H "Authorization: Bearer YOUR_ANON_KEY"
```

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–∫–µ—Ç:**
```bash
curl https://YOUR_PROJECT_ID.supabase.co/functions/v1/make-server-3e5c72fb/storage/init \
  -H "Authorization: Bearer YOUR_ANON_KEY"
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –í—Ä—É—á–Ω—É—é –≤ Supabase Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://app.supabase.com)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Storage**
3. –ù–∞–∂–º–∏—Ç–µ **New Bucket**
4. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∫–µ—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
   - **Name:** `katia-images`
   - **Public:** `true` (–≤–∫–ª—é—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø)
   - **File size limit:** `5242880` (5MB)
   - **Allowed MIME types:**
     - `image/png`
     - `image/jpeg`
     - `image/jpg`
     - `image/webp`
     - `image/svg+xml`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –≤ –±–∞–∫–µ—Ç–µ

–ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∫–µ—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞–ø–∫–∏:

```
katia-images/
‚îú‚îÄ‚îÄ logos/         # –õ–æ–≥–æ—Ç–∏–ø—ã —Å–∞–ª–æ–Ω–æ–≤
‚îú‚îÄ‚îÄ products/      # –§–æ—Ç–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
‚îú‚îÄ‚îÄ certificates/  # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ masters/       # –§–æ—Ç–æ –º–∞—Å—Ç–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ gallery/       # –ì–∞–ª–µ—Ä–µ—è —Å–∞–ª–æ–Ω–æ–≤
‚îú‚îÄ‚îÄ avatars/       # –ê–≤–∞—Ç–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îî‚îÄ‚îÄ general/       # –û–±—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–í Supabase Dashboard:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Storage**
   - –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –±–∞–∫–µ—Ç `katia-images`
   - –°—Ç–∞—Ç—É—Å: **Public**
   - –ú–æ–∂–Ω–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø–∞–ø–∫–∏ –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã

2. **–í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `/storage-admin`
   - –î–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–∞–ø–∫–∞–º
   - –°—á–µ—Ç—á–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∫–∞–∂–¥–æ–π –ø–∞–ø–∫–µ

3. **–í –¥–µ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü–µ:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `/image-storage-demo`
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö –ø–∞–ø–æ–∫

## Endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Storage

| Endpoint | Method | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|----------|
| `/storage/status` | GET | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–∞–∫–µ—Ç–∞ |
| `/storage/init` | GET | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–∫–µ—Ç |
| `/storage/upload` | POST | –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª |
| `/storage/upload-url` | POST | –ü–æ–ª—É—á–∏—Ç—å signed URL |
| `/storage/images/:folder?` | GET | –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ |
| `/storage/delete` | DELETE | –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª |
| `/storage/public-url/*` | GET | –ü–æ–ª—É—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π URL |

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

–ë–∞–∫–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `ensureBucketExists()` –≤ —Ñ–∞–π–ª–µ `/supabase/functions/server/storage-routes.ts`.

–ï—Å–ª–∏ –±–∞–∫–µ—Ç –Ω–µ —Å–æ–∑–¥–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ Supabase Functions
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `SUPABASE_SERVICE_ROLE_KEY` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å `/storage-admin` –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

## Troubleshooting

**–û—à–∏–±–∫–∞ "Failed to create bucket":**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ `SUPABASE_SERVICE_ROLE_KEY`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∫–µ—Ç —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —É–∂–µ

**–ë–∞–∫–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ø—É—Å—Ç–æ–π:**
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –±–∞–∫–µ—Ç–∞
- –ü–∞–ø–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞

**–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∫–µ—Ç –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å `public: true`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–∞–ø–∫—É
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π URL —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ `/storage/public-url`

## Backend —Ñ–∞–π–ª—ã

- **Routes:** `/supabase/functions/server/storage-routes.ts`
- **Main server:** `/supabase/functions/server/index.tsx`

## Frontend —Ñ–∞–π–ª—ã

- **Admin panel:** `/src/app/storage-admin.tsx`
- **Demo page:** `/src/app/pages/ImageStorageDemo.tsx`
- **Components:** `/src/app/components/storage/`
- **Hooks:** `/src/app/hooks/useSupabaseStorage.ts`
- **Utils:** `/src/app/utils/supabaseStorage.ts`

---

**–°–æ–∑–¥–∞–Ω–æ:** 25 –¥–µ–∫–∞–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready  
**Backend endpoints:** 7  
**Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:** 3  
**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** –î–∞
