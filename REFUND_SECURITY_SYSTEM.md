# üîê Katia Platform - Secure Refund System

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤ Katia —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∑–∞—â–∏—Ç–æ–π –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞ –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–µ–Ω–µ–≥ —Ç–æ–ª—å–∫–æ –∑–∞–∫–æ–Ω–Ω—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–∞–º —Å–∞–ª–æ–Ω–æ–≤.

---

## üõ°Ô∏è –£—Ä–æ–≤–Ω–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞–º–æ–∫ (7 –¥–Ω–µ–π)**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ—Å–ª–µ 7 –¥–Ω–µ–π
- üìä –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –¥–Ω–µ–π

```typescript
const daysFromPayment = Math.floor(
  (today.getTime() - paymentDate.getTime()) / (1000 * 60 * 60 * 24)
);
const isEligible = daysFromPayment <= 7;
```

### 2. **Email-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞**
- üîí Email –¥–æ–ª–∂–µ–Ω —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —Å–∞–ª–æ–Ω–∞
- üìß –û—Ç–ø—Ä–∞–≤–∫–∞ verification link –Ω–∞ email
- ‚è±Ô∏è –¢–æ–∫–µ–Ω —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ (24 —á–∞—Å–∞)
- üîê –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω (–Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–≤–∞–∂–¥—ã)

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ email
if (confirmEmail.toLowerCase().trim() !== salon.email.toLowerCase().trim()) {
  setEmailError('Email does not match salon owner email');
  return;
}
```

### 3. **–î–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ**

#### –≠—Ç–∞–ø 1: –ö–ª–∏–µ–Ω—Ç
1. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –≤–æ–∑–≤—Ä–∞—Ç–∞
2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç email
3. –°–æ–≥–ª–∞—à–∞–µ—Ç—Å—è —Å —É—Å–ª–æ–≤–∏—è–º–∏
4. –ü–æ–ª—É—á–∞–µ—Ç verification email

#### –≠—Ç–∞–ø 2: Super Admin
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
2. –í–∏–¥–∏—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–ø—Ä–∏—á–∏–Ω–∞, –¥–Ω–∏, –∏—Å—Ç–æ—Ä–∏—è)
3. –û–¥–æ–±—Ä—è–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç —Å –ø—Ä–∏—á–∏–Ω–æ–π
4. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ Stripe

### 4. **–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–π –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã**
- üí≥ –î–µ–Ω—å–≥–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –Ω–∞ —Ç—É –∂–µ –∫–∞—Ä—Ç—É/–º–µ—Ç–æ–¥
- üö´ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—è
- üîê Stripe –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫

```typescript
// –í–æ–∑–≤—Ä–∞—Ç —á–µ—Ä–µ–∑ Stripe API
const refund = await stripe.refunds.create({
  payment_intent: paymentIntentId,
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–π –º–µ—Ç–æ–¥
});
```

---

## üìã –ü—Ä–æ—Ü–µ—Å—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ (Step-by-Step)

### –î–ª—è –∫–ª–∏–µ–Ω—Ç–∞:

1. **–ó–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞**
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "Request Refund"
   - –í–∏–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∞–≤–µ –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç (–¥–Ω–∏)
   - –í–∏–¥–∏—Ç —Å—É–º–º—É –∏ –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞

2. **–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã**
   - –ü—Ä–∏—á–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å)
   - –°–æ–≥–ª–∞—Å–∏–µ —Å —É—Å–ª–æ–≤–∏—è–º–∏

3. **Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**
   - –ü–æ–ª—É—á–∞–µ—Ç email —Å —Å—Å—ã–ª–∫–æ–π
   - –ö–ª–∏–∫–∞–µ—Ç –ø–æ —Å—Å—ã–ª–∫–µ (–¥–µ–π—Å—Ç–≤—É–µ—Ç 24 —á–∞—Å–∞)
   - –ó–∞–ø—Ä–æ—Å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å "Verified"

4. **–û–∂–∏–¥–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è**
   - Super admin –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å
   - –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç email –æ —Ä–µ—à–µ–Ω–∏–∏
   - –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ - –≤–æ–∑–≤—Ä–∞—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –î–ª—è Super Admin:

1. **–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞–∑–¥–µ–ª "Refund Requests" –≤ —Å—É–ø–µ—Ä –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
   - –í–∏–¥–∏—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏
   - –ú–æ–∂–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ —Å—Ç–∞—Ç—É—Å—É

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ—Ç–∞–ª–µ–π**
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–ª–æ–Ω–µ –∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ
   - –î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
   - –ü—Ä–∏—á–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
   - –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–∏—Ç–∏–∫–µ (7 –¥–Ω–µ–π)

3. **–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è**
   - **Approve**: –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç —á–µ—Ä–µ–∑ Stripe
   - **Reject**: –£–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–∞–∑–∞
   - –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç email —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º

4. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ**
   - –í–∏–¥–∏—Ç Stripe Refund ID
   - –î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤

---

## üö® –ó–∞—â–∏—Ç–∞ –æ—Ç –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:

‚úÖ **Email –≤–ª–∞–¥–µ–ª—å—Ü–∞**
- –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
- Case-insensitive —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
- Trim –ø—Ä–æ–±–µ–ª–æ–≤

‚úÖ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏**
- –ú–∞–∫—Å–∏–º—É–º 7 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏

‚úÖ **–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã**
- –¢–æ–∫–µ–Ω email verification –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π
- –ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```typescript
{
  timestamp: '2024-12-24T10:30:00Z',
  action: 'REFUND_REQUEST',
  salonId: 123,
  email: 'owner@salon.com',
  ipAddress: '192.168.1.1',
  amount: 299,
  status: 'pending_verification'
}
```

‚úÖ **Admin –æ–¥–æ–±—Ä–µ–Ω–∏–µ**
- –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª–æ–Ω–∏—Ç—å —Å –ø—Ä–∏—á–∏–Ω–æ–π
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

---

## üí∞ –ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –¥–µ–Ω—å–≥–∏

### Stripe –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç:

```typescript
// –ü—Ä–∏–º–µ—Ä Stripe refund
const refund = await stripe.refunds.create({
  payment_intent: 'pi_xxx',
  amount: 29900, // –í —Ü–µ–Ω—Ç–∞—Ö (AED 299.00)
  reason: 'requested_by_customer',
  metadata: {
    salonId: '123',
    adminApprovedBy: 'admin@katia.beauty',
    approvedAt: '2024-12-24T10:30:00Z'
  }
});

// Stripe –≤–µ—Ä–Ω–µ—Ç –¥–µ–Ω—å–≥–∏ –Ω–∞:
// - –¢—É –∂–µ –∫–∞—Ä—Ç—É (Visa ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242)
// - –¢–æ—Ç –∂–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å—á–µ—Ç
// - –¢–æ—Ç –∂–µ PayPal –∞–∫–∫–∞—É–Ω—Ç
// (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã)
```

### –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ:
‚ùå –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞
‚ùå –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –¥—Ä—É–≥—É—é –∫–∞—Ä—Ç—É
‚ùå –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–ª–∏—á–Ω—ã–º–∏
‚ùå –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ –¥—Ä—É–≥–æ–π –∞–∫–∫–∞—É–Ω—Ç

### –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:
- Instant approval: –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–æ–º
- Stripe processing: 5-10 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∞–Ω–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞

---

## üìä –°—Ç–∞—Ç—É—Å—ã –∑–∞–ø—Ä–æ—Å–æ–≤

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏—è |
|--------|----------|----------|
| `pending_verification` | –û–∂–∏–¥–∞–µ—Ç email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è | –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∫–ª–∏–∫–Ω—É—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ |
| `verified` | Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω | –û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–æ–º |
| `pending_approval` | –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ —É –∞–¥–º–∏–Ω–∞ | –ê–¥–º–∏–Ω –¥–æ–ª–∂–µ–Ω –æ–¥–æ–±—Ä–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å |
| `approved` | –û–¥–æ–±—Ä–µ–Ω–æ | Stripe –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç |
| `rejected` | –û—Ç–∫–ª–æ–Ω–µ–Ω–æ | –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ |
| `processed` | –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ | –î–µ–Ω—å–≥–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã |

---

## üîî Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç:

1. **Verification Email**
```
Subject: Verify Your Refund Request - Katia Platform

Hello [Owner Name],

You requested a refund for [Salon Name].

Amount: AED [Amount]
Payment Method: [Method]

Click here to verify: [Verification Link]
(Link expires in 24 hours)

If you didn't request this, please ignore this email.
```

2. **Approval Email**
```
Subject: Your Refund Has Been Approved - Katia Platform

Good news! Your refund request has been approved.

Amount: AED [Amount]
Refund to: [Payment Method]
Processing time: 5-10 business days

Stripe Refund ID: [ID]
```

3. **Rejection Email**
```
Subject: Refund Request Update - Katia Platform

We're sorry, but your refund request has been declined.

Reason: [Admin Reason]

If you have questions, contact: support@katia.beauty
```

### Admin –ø–æ–ª—É—á–∞–µ—Ç:

1. **New Request Notification**
```
Subject: New Refund Request - [Salon Name]

Salon: [Name]
Owner: [Owner]
Amount: AED [Amount]
Days from payment: [X] days

Review now: [Admin Panel Link]
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Backend (Supabase Edge Function)

```typescript
// /supabase/functions/server/refunds.ts
import { createClient } from '@supabase/supabase-js';
import Stripe from 'stripe';

export async function handleRefundRequest(request: RefundRequestData) {
  // 1. Validate eligibility
  if (request.daysFromPayment > 7) {
    throw new Error('Refund period expired');
  }

  // 2. Verify email
  const salon = await getSalonById(request.salonId);
  if (salon.email.toLowerCase() !== request.confirmationEmail.toLowerCase()) {
    throw new Error('Email verification failed');
  }

  // 3. Create verification token
  const token = generateSecureToken();
  await storeVerificationToken({
    token,
    salonId: request.salonId,
    expiresAt: Date.now() + 24 * 60 * 60 * 1000, // 24 hours
    used: false
  });

  // 4. Send verification email
  await sendVerificationEmail({
    to: request.confirmationEmail,
    token,
    salonName: request.salonName,
    amount: request.amount
  });

  // 5. Log the request
  await logRefundRequest(request);

  return { success: true, message: 'Verification email sent' };
}

export async function processRefund(refundId: number, approved: boolean, adminId: string) {
  const refund = await getRefundById(refundId);

  if (approved) {
    // Initialize Stripe
    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);

    // Process refund
    const stripeRefund = await stripe.refunds.create({
      payment_intent: refund.paymentIntentId,
      amount: refund.amount * 100, // Convert to cents
      reason: 'requested_by_customer',
      metadata: {
        salonId: refund.salonId.toString(),
        approvedBy: adminId,
        refundRequestId: refundId.toString()
      }
    });

    // Update database
    await updateRefundStatus(refundId, {
      status: 'approved',
      stripeRefundId: stripeRefund.id,
      processedAt: new Date(),
      processedBy: adminId
    });

    // Send confirmation email
    await sendRefundApprovedEmail(refund);

  } else {
    // Reject refund
    await updateRefundStatus(refundId, {
      status: 'rejected',
      processedAt: new Date(),
      processedBy: adminId
    });

    // Send rejection email
    await sendRefundRejectedEmail(refund);
  }
}
```

### Frontend Components

- `RefundRequestModal.tsx` - –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–æ—Ä–º–∞ –∑–∞–ø—Ä–æ—Å–∞
- `AdminRefundManagement.tsx` - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- Integration –≤ `SuperAdminDashboardPlans.tsx`

---

## üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã

Super admin –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å:

- üìä –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ü—Ä–æ—Ü–µ–Ω—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
- üí∞ –û–±—â–∞—è —Å—É–º–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- üìÖ –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- üîç –ü—Ä–∏—á–∏–Ω—ã –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ (—Ç–æ–ø 10)
- üìà –¢—Ä–µ–Ω–¥ –ø–æ –º–µ—Å—è—Ü–∞–º

---

## ‚öñÔ∏è –ü–æ–ª–∏—Ç–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞

### –ü—Ä–∞–≤–∏–ª–∞:
1. ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ **7 –¥–Ω–µ–π** —Å –º–æ–º–µ–Ω—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
2. ‚úÖ –¢–æ–ª—å–∫–æ –¥–ª—è **–≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å–∞–ª–æ–Ω–∞** (email verification)
3. ‚úÖ –¢–æ–ª—å–∫–æ –Ω–∞ **–∏—Å—Ö–æ–¥–Ω—ã–π –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã**
4. ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è **–¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ** (–∫–ª–∏–µ–Ω—Ç + admin)
5. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ **Stripe** (–±–µ–∑–æ–ø–∞—Å–Ω–æ)

### –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
- ‚ùå –ü–æ—Å–ª–µ 7 –¥–Ω–µ–π - –ù–ï–¢ –≤–æ–∑–≤—Ä–∞—Ç–∞ (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ support)
- ‚ùå –ï—Å–ª–∏ email –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç - –û–¢–ö–õ–û–ù–ï–ù–û
- ‚ùå –ï—Å–ª–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ - –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û

---

## üéØ Best Practices

### –î–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:
1. –ó–∞–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –≤–æ–∑–≤—Ä–∞—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 7 –¥–Ω–µ–π
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ email –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å–∞–ª–æ–Ω–∞
3. –£–∫–∞–∂–∏—Ç–µ —á–µ—Ç–∫—É—é –ø—Ä–∏—á–∏–Ω—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email (–≤–∫–ª—é—á–∞—è spam)
5. –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ verification link –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤

### –î–ª—è –∞–¥–º–∏–Ω–æ–≤:
1. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ
2. –°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –¥–Ω–∏ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
3. –ß–∏—Ç–∞–π—Ç–µ –ø—Ä–∏—á–∏–Ω—É –≤–æ–∑–≤—Ä–∞—Ç–∞
4. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é —Å–∞–ª–æ–Ω–∞
5. –ü—Ä–∏ —Å–æ–º–Ω–µ–Ω–∏—è—Ö - –æ—Ç–∫–ª–æ–Ω—è–π—Ç–µ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
6. –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ä–µ—à–µ–Ω–∏—è

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è:
```typescript
{
  id: number,
  salonId: number,
  email: string, // –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω
  amount: number,
  reason: string,
  status: string,
  verificationToken: string, // Hashed
  createdAt: timestamp,
  verifiedAt: timestamp,
  processedAt: timestamp,
  stripeRefundId: string,
  ipAddress: string, // –î–ª—è fraud detection
  userAgent: string
}
```

### –ß—Ç–æ –ù–ï —Ö—Ä–∞–Ω–∏—Ç—Å—è:
- ‚ùå –ü–æ–ª–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç
- ‚ùå CVV –∫–æ–¥—ã
- ‚ùå –ü–∞—Ä–æ–ª–∏
- ‚ùå –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

---

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –∫–ª–∏–µ–Ω—Ç–∞ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
- üìß Email: support@katia.beauty
- üí¨ Live Chat –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- üìû Phone: +971 XX XXX XXXX
- üé´ Ticket system –≤ admin –ø–∞–Ω–µ–ª–∏

---

## üìù Changelog

### v1.0.0 (2024-12-24)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
- ‚úÖ Email verification
- ‚úÖ Admin approval workflow
- ‚úÖ Stripe integration
- ‚úÖ Multi-level security
- ‚úÖ Logging & analytics

---

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∑–∞—â–∏—Ç—É –æ—Ç –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –≤–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥ —Ç–æ–ª—å–∫–æ –∑–∞–∫–æ–Ω–Ω—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–∞–º —Å–∞–ª–æ–Ω–æ–≤ –Ω–∞ –∏—Ö –∏—Å—Ö–æ–¥–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã! üîê‚ú®
