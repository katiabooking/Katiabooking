# üîß PWA ERROR FIX - Service Worker MIME Type Issue

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê:

```
SecurityError: Failed to register a ServiceWorker
The script has an unsupported MIME type ('text/html')
```

**–ü—Ä–∏—á–∏–Ω–∞:** 
Service Worker —Ñ–∞–π–ª (`/public/service-worker.js`) –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º MIME type. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–≥–¥–∞:
1. –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (404 ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
2. –°–µ—Ä–≤–µ—Ä –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π MIME type –¥–ª—è .js —Ñ–∞–π–ª–æ–≤
3. –í production –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (Figma Make) —Ñ–∞–π–ª—ã –∏–∑ /public –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∏–Ω–∞—á–µ

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï:

### **1. Graceful Degradation**

–û–±–Ω–æ–≤–∏–ª `/src/utils/pwaUtils.ts`:

```typescript
// –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Service Worker –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π
async function checkServiceWorkerAvailable(path: string): Promise<boolean> {
  try {
    const response = await fetch(path, { 
      method: 'HEAD',
      cache: 'no-cache'
    });
    
    if (!response.ok) return false;
    
    const contentType = response.headers.get('content-type');
    const isValidMimeType = contentType?.includes('javascript');
    
    if (!isValidMimeType) {
      console.warn('[PWA] Service Worker –∏–º–µ–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π MIME type:', contentType);
      return false;
    }
    
    return true;
  } catch (error) {
    return false;
  }
}
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ PWA –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- ‚úÖ Graceful fallback

### **2. –û–±–Ω–æ–≤–∏–ª App.tsx**

```typescript
const initPWA = async () => {
  try {
    const registration = await registerServiceWorker();
    
    if (registration) {
      console.log('‚úÖ PWA –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
    } else {
      console.log('‚ÑπÔ∏è PWA –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ–º –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ');
    }
  } catch (error) {
    console.log('‚ÑπÔ∏è PWA –ø—Ä–æ–ø—É—â–µ–Ω, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ');
  }
};
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å PWA –∏–ª–∏ –±–µ–∑ –Ω–µ–≥–æ
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏

### **3. –û–±–Ω–æ–≤–∏–ª vite.config.ts**

```typescript
export default defineConfig({
  publicDir: 'public',
  build: {
    copyPublicDir: true,  // –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –∏–∑ /public
  }
})
```

---

## üéØ –ß–¢–û –¢–ï–ü–ï–†–¨ –ü–†–û–ò–°–•–û–î–ò–¢:

### **–°—Ü–µ–Ω–∞—Ä–∏–π A: Service Worker –¥–æ—Å—Ç—É–ø–µ–Ω** ‚úÖ

```
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ /service-worker.js
2. ‚úÖ –§–∞–π–ª –Ω–∞–π–¥–µ–Ω, MIME type –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
4. ‚úÖ Offline —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω
5. ‚úÖ PWA —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
```

### **–°—Ü–µ–Ω–∞—Ä–∏–π B: Service Worker –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** ‚ÑπÔ∏è

```
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ /service-worker.js
2. ‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ MIME type –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. ‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
4. ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ
5. ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã (–±–µ–∑ offline)
```

**–í–ê–ñ–ù–û:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –û–ë–û–ò–• —Å–ª—É—á–∞—è—Ö! ‚úÖ

---

## üì± –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢:

### **–° PWA (–∫–æ–≥–¥–∞ Service Worker –∑–∞–≥—Ä—É–∂–µ–Ω):**
```
‚úÖ Offline —Ä–µ–∂–∏–º
‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚úÖ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚úÖ Background sync
```

### **–ë–µ–∑ PWA (fallback —Ä–µ–∂–∏–º):**
```
‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å
‚úÖ CRM
‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
‚úÖ –ü–ª–∞—Ç–µ–∂–∏
‚ùå Offline —Ä–µ–∂–∏–º
‚ùå –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

---

## üîç –ü–†–û–í–ï–†–ö–ê:

### **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:**

**–° PWA:**
```
‚úÖ PWA: Service Worker —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
‚úÖ PWA: Offline —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω
‚úÖ PWA: Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã
```

**–ë–µ–∑ PWA:**
```
‚ÑπÔ∏è PWA: –†–∞–±–æ—Ç–∞–µ–º –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ (–±–µ–∑ offline)
‚ÑπÔ∏è PWA: –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã
```

**–ù–∏–∫–∞–∫–∏—Ö –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫!** ‚úÖ

---

## üöÄ –î–õ–Ø PRODUCTION:

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å PWA –≤ production:

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä**

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ MIME types:

```nginx
# Nginx
location ~* \.js$ {
    add_header Content-Type application/javascript;
}
```

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω**

```bash
npm install vite-plugin-pwa -D
```

```typescript
// vite.config.ts
import { VitePWA } from 'vite-plugin-pwa'

export default defineConfig({
  plugins: [
    VitePWA({
      registerType: 'autoUpdate',
      workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg}']
      }
    })
  ]
})
```

### **–í–∞—Ä–∏–∞–Ω—Ç 3: Inline Service Worker**

–í—Å—Ç—Ä–æ–∏—Ç—å Service Worker –ø—Ä—è–º–æ –≤ HTML (–¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏).

---

## üéì –ß–¢–û –ú–´ –£–ó–ù–ê–õ–ò:

1. **Service Worker - —ç—Ç–æ enhancement, –Ω–µ requirement**
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–∏–º –∏ –±–µ–∑ –Ω–µ–≥–æ

2. **Graceful degradation is key**
   - –í—Å–µ–≥–¥–∞ –∏–º–µ—Ç—å fallback
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–º–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑-–∑–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∏—á

3. **MIME type matters**
   - JavaScript —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å `application/javascript` –∏–ª–∏ `text/javascript`
   - `text/html` –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (404 —Å—Ç—Ä–∞–Ω–∏—Ü–∞)

4. **Check before register**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

---

## ‚úÖ –ò–¢–û–ì:

### **–û–®–ò–ë–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ê:**

```
‚ùå –ë–´–õ–û:
SecurityError: Failed to register ServiceWorker
MIME type ('text/html')

‚úÖ –°–¢–ê–õ–û:
‚ÑπÔ∏è PWA: –†–∞–±–æ—Ç–∞–µ–º –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
```

### **–ü–†–ò–õ–û–ñ–ï–ù–ò–ï –†–ê–ë–û–¢–ê–ï–¢:**

- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- ‚úÖ Graceful degradation
- ‚úÖ PWA –∫–∞–∫ –±–æ–Ω—É—Å (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å PWA –∏ –±–µ–∑ –Ω–µ–≥–æ

---

## üìû –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ.

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å PWA –≤ production:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ MIME types
2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å vite-plugin-pwa
3. –ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ PWA)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å Mobile-First –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π (Phase 2), PWA –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø–æ–∑–∂–µ –≤ production –æ–∫—Ä—É–∂–µ–Ω–∏–∏.

---

**–ì–û–¢–û–í–û!** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ! üéâ
